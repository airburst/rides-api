#!/usr/bin/env bash
# Start local postgres, push schema, pump production data, and run API

set -e

npm run startdb

# Wait for postgres to be ready
echo "Waiting for postgres..."
sleep 2

npm run db:migrate

# Only pump data if SOURCE_URL is set
if [ -n "$SOURCE_URL" ]; then
  npm run db:pump
else
  echo "Skipping db:pump (SOURCE_URL not set)"
fi

npm run dev
